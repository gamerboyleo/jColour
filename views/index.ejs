<!DOCTYPE html>
<html>

<%- include('elements/meta', {
	title: server ? `${server.name} Colours` : "Server not found",
	desc: server ? `Colours for ${server.name}` : "Was it my fault?"
}) %>

	<body>

		<div class="is-page">
			
			<%- include('elements/header', {
				text: server ? `Colours for ${server.name}` : "Server not found."
			}) %>

			<section class="hero colours">
				<a name="colours"></a>
				<% if (server) { %>
					<h2 class="subtitle">
						Click a colour to see a Discord chat preview.
					</h2>

					<div class="container ">

						<div class="columns is-multiline is-inline-flex-touch">

						<% 
						
						function convertToHSL (hex) {
							var result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);

							var r = parseInt(result[1], 16);
							var g = parseInt(result[2], 16);
							var b = parseInt(result[3], 16);

							r /= 255, g /= 255, b /= 255;
							var max = Math.max(r, g, b), min = Math.min(r, g, b);
							var h, s, l = (max + min) / 2;

							if(max == min){
								h = s = 0; // achromatic
							} else {
								var d = max - min;
								s = l > 0.5 ? d / (2 - max - min) : d / (max + min);
								switch(max) {
									case r: h = (g - b) / d + (g < b ? 6 : 0); break;
									case g: h = (b - r) / d + 2; break;
									case b: h = (r - g) / d + 4; break;
								}
								h /= 6;
							}

							s = s*100;
							s = Math.round(s);
							l = l*100;
							l = Math.round(l);
							h = Math.round(360*h);

							return [h, s, l];
						}						
						
						const roles = server.roles.array();
						const colourRoles = roles.filter(role => role.name.startsWith("colour "));
						const roleCount = colourRoles.length;
						colourRoles.sort(function (a, b) {
     					   return convertToHSL(a.hexColor)[0] - convertToHSL(b.hexColor)[0];
   						 });
						colourRoles.forEach(function(element) { %>
								<%- include('elements/colorCard', {
								element: element, 
								tinycolor: tinycolor
							}) %>


									<% }) 
						if(roleCount === 0) { %>
										<h1 class="title">Server roles not setup! Ask an administrator to run j!tutorial.</h1>
										<% }%>

						</div>

						<% } else { %>
							<h1 class="title">Server not available!</h1>
							<h2 class="subtitle">Are you sure this is the correct URL?</h2>
							<% } %>

					</div>
			</section>
		</div>

		<%- include elements/footer %>

			<script>
				var toggleModal = (elemId) => {
					var elem = document.getElementById(elemId + "-modal");
					elem.classList.toggle("is-active");
				}
			</script>

	</body>

</html>